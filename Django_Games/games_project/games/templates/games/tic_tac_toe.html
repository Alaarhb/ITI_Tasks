{% extends 'games/base.html' %}

{% block title %}Tic Tac Toe - Django Games{% endblock %}

{% block content %}
<div style="text-align: center;">
    <h2>‚ùå Tic Tac Toe</h2>
    <p style="margin: 20px 0; font-size: 18px; color: #666;">
        You are X, Computer is O. Get three in a row to win!
    </p>
    
    <div style="margin-bottom: 20px;">
        <input type="text" id="playerName" placeholder="Enter your name" style="padding: 10px; border-radius: 5px; border: 2px solid #ddd; font-size: 16px;">
    </div>
    
    <div id="gameBoard" style="display: grid; grid-template-columns: repeat(3, 100px); gap: 5px; justify-content: center; margin: 20px auto; max-width: 320px;">
        <!-- Board cells will be generated by JavaScript -->
    </div>
    
    <div id="gameMessage" style="margin: 20px 0; font-size: 18px; font-weight: bold; min-height: 25px;"></div>
    
    <button onclick="resetGame()" class="btn">üîÑ New Game</button>
    
    <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 10px;">
        <h4>üéÆ How to Play:</h4>
        <ul style="text-align: left; display: inline-block;">
            <li>Click any empty square to place your X</li>
            <li>Computer will automatically place O</li>
            <li>Get three X's in a row, column, or diagonal to win</li>
            <li>Winning gives you 100 points!</li>
        </ul>
    </div>
</div>

<script>
let board = ['', '', '', '', '', '', '', '', ''];
let gameActive = true;

function initializeBoard() {
    const gameBoard = document.getElementById('gameBoard');
    gameBoard.innerHTML = '';
    
    for (let i = 0; i < 9; i++) {
        const cell = document.createElement('div');
        cell.style.cssText = `
            width: 100px;
            height: 100px;
            background: white;
            border: 3px solid #667eea;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 5px;
        `;
        cell.onclick = () => makeMove(i);
        cell.onmouseover = () => {
            if (board[i] === '' && gameActive) {
                cell.style.backgroundColor = '#f0f0f0';
            }
        };
        cell.onmouseout = () => {
            if (board[i] === '') {
                cell.style.backgroundColor = 'white';
            }
        };
        gameBoard.appendChild(cell);
    }
    updateBoard();
}

function makeMove(position) {
    if (!gameActive || board[position] !== '') return;
    
    const playerName = document.getElementById('playerName').value || 'Anonymous';
    
    fetch('{% url "tic_tac_toe_move" %}', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken')
        },
        body: JSON.stringify({
            board: board,
            position: position,
            player_name: playerName
        })
    })
    .then(response => response.json())
    .then(data => {
        board = data.board;
        updateBoard();
        
        if (data.winner) {
            gameActive = false;
            const messageElement = document.getElementById('gameMessage');
            messageElement.innerHTML = data.message;
            if (data.winner === 'X') {
                messageElement.style.color = 'green';
            } else if (data.winner === 'O') {
                messageElement.style.color = 'red';
            } else {
                messageElement.style.color = 'orange';
            }
        }
    })
    .catch(error => {
        console.error('Error:', error);
    });
}

function updateBoard() {
    const cells = document.getElementById('gameBoard').children;
    for (let i = 0; i < 9; i++) {
        cells[i].textContent = board[i];
        cells[i].style.color = board[i] === 'X' ? '#667eea' : '#764ba2';
        cells[i].style.cursor = (board[i] === '' && gameActive) ? 'pointer' : 'default';
        if (board[i] !== '') {
            cells[i].style.backgroundColor = '#f8f9fa';
        }
    }
}

function resetGame() {
    board = ['', '', '', '', '', '', '', '', ''];
    gameActive = true;
    document.getElementById('gameMessage').innerHTML = '';
    updateBoard();
}

function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

// Initialize the game when page loads
document.addEventListener('DOMContentLoaded', function() {
    initializeBoard();
});
</script>
{% endblock %}