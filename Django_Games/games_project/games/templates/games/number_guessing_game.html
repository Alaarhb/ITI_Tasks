{% extends 'games/base.html' %}
{% load static %}
{% load games_extras %}

{% block title %}{{ game.get_name_display }} - Django Games Lab2{% endblock %}

{% block content %}
<div class="tic-tac-toe-container">
    <!-- DTL Variables: Game header -->
    <h2>{{ game.icon }} {{ game.get_name_display }}</h2>
    <p style="margin: 20px 0; font-size: 18px; color: #666;">
        {{ game.description }}
    </p>
    
    <!-- Player Input -->
    <div class="form-group" style="max-width: 300px; margin: 0 auto 20px;">
        <label for="playerName">Your Name:</label>
        <input type="text" id="playerName" placeholder="Enter your name" class="fade-in-up">
    </div>
    
    <!-- Game Board -->
    <div id="gameBoard" class="game-board fade-in-up">
        <!-- Board cells generated by JavaScript -->
    </div>
    
    <!-- Game Status -->
    <div id="gameMessage" class="game-status"></div>
    
    <!-- Controls -->
    <div class="text-center mt-3">
        <button onclick="resetGame()" class="btn">🔄 New Game</button>
    </div>
    
    <!-- Game Statistics using DTL Variables -->
    {% if game_stats %}
    <div class="stats-container mt-4">
        <h4>📊 Game Statistics</h4>
        <div class="stats-grid">
            <div class="stat-item">
                <span class="stat-value">{{ game_stats.total_games|default:0 }}</span>
                <span class="stat-label">Total Games</span>
            </div>
            <div class="stat-item">
                <!-- DTL Filter: Percentage calculation -->
                <span class="stat-value">{{ win_percentage|floatformat:1 }}%</span>
                <span class="stat-label">Win Rate</span>
            </div>
            <div class="stat-item">
                <span class="stat-value">{{ game_stats.wins|default:0 }}</span>
                <span class="stat-label">Player Wins</span>
            </div>
            <div class="stat-item">
                <span class="stat-value">{{ game_stats.losses|default:0 }}</span>
                <span class="stat-label">Computer Wins</span>
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- Recent Games using DTL For Loop -->
    {% if recent_games %}
    <div class="stats-container">
        <h4>🕒 Recent Games</h4>
        <div class="score-list">
            {% for game_score in recent_games %}
                <div class="score-item">
                    <div class="player-info">
                        <div class="player-avatar">
                            {{ game_score.player.name|first|upper }}
                        </div>
                        <div>
                            <strong>{{ game_score.player.name }}</strong><br>
                            <!-- DTL Filter: Time formatting -->
                            <small>{{ game_score.created_at|timesince }} ago</small>
                        </div>
                    </div>
                    <!-- DTL Conditional: Result display -->
                    <div class="score-badge {% if game_score.score == 100 %}excellent{% elif game_score.score == 50 %}average{% else %}poor{% endif %}">
                        {% if game_score.score == 100 %}
                            🏆 Won
                        {% elif game_score.score == 50 %}
                            🤝 Draw
                        {% else %}
                            💔 Lost
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
    
    <!-- Game Instructions -->
    <div class="game-instructions">
        <h4>🎮 How to Play:</h4>
        <ul>
            <li>Click any empty square to place your X</li>
            <li>Computer will automatically place O</li>
            <li>Get three X's in a row, column, or diagonal to win</li>
            <li>Winning gives you {{ game.max_score }} points!</li>
        </ul>
    </div>
</div>
{% endblock %}
